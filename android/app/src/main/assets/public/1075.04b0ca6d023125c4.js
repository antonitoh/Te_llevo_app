(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1075],{1075:(C,I,w)=>{"use strict";w.d(I,{T:()=>Or});class S extends Error{constructor(r,e="FunctionsError",t){super(r),this.name=e,this.context=t}}class ee extends S{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class M extends S{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class R extends S{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}class N{constructor(r,{headers:e={},customFetch:t}={}){this.url=r,this.headers=e,this.fetch=(i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(w.bind(w,9470)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)})(t)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r,e={}){var t;return function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(u){try{c(t.next(u))}catch(d){o(d)}}function l(u){try{c(t.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(u.value).then(a,l)}c((t=t.apply(i,r||[])).next())})}(this,void 0,void 0,function*(){try{const{headers:n,method:s,body:o}=e;let l,a={};o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):"string"==typeof o?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${r}`,{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:l}).catch(p=>{throw new ee(p)}),u=c.headers.get("x-relay-error");if(u&&"true"===u)throw new M(c);if(!c.ok)throw new R(c);let g,d=(null!==(t=c.headers.get("Content-Type"))&&void 0!==t?t:"text/plain").split(";")[0].trim();return g="application/json"===d?yield c.json():"application/octet-stream"===d?yield c.blob():"multipart/form-data"===d?yield c.formData():yield c.text(),{data:g,error:null}}catch(n){return{data:null,error:n}}})}}var h=w(5861),de=w(9470);class Ye{constructor(r){this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=r.headers,this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=r.shouldThrowOnError,this.signal=r.signal,this.isMaybeSingle=r.isMaybeSingle,this.fetch=r.fetch?r.fetch:typeof fetch>"u"?de.default:fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(r,e){var t=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(function(){var o=(0,h.Z)(function*(a){var l,c,u;let d=null,g=null,p=null,f=a.status,_=a.statusText;if(a.ok){if("HEAD"!==t.method){const j=yield a.text();""===j||(g="text/csv"===t.headers.Accept||t.headers.Accept&&t.headers.Accept.includes("application/vnd.pgrst.plan+text")?j:JSON.parse(j))}const k=null===(l=t.headers.Prefer)||void 0===l?void 0:l.match(/count=(exact|planned|estimated)/),O=null===(c=a.headers.get("content-range"))||void 0===c?void 0:c.split("/");k&&O&&O.length>1&&(p=parseInt(O[1])),t.isMaybeSingle&&"GET"===t.method&&Array.isArray(g)&&(g.length>1?(d={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,p=null,f=406,_="Not Acceptable"):g=1===g.length?g[0]:null)}else{const k=yield a.text();try{d=JSON.parse(k),Array.isArray(d)&&404===a.status&&(g=[],d=null,f=200,_="OK")}catch{404===a.status&&""===k?(f=204,_="No Content"):d={message:k}}if(d&&t.isMaybeSingle&&!(null===(u=null==d?void 0:d.details)||void 0===u)&&u.includes("0 rows")&&(d=null,f=200,_="OK"),d&&t.shouldThrowOnError)throw d}return{error:d,data:g,count:p,status:f,statusText:_}});return function(a){return o.apply(this,arguments)}}());return this.shouldThrowOnError||(s=s.catch(o=>{var a,l,c;return{error:{message:`${null!==(a=null==o?void 0:o.name)&&void 0!==a?a:"FetchError"}: ${null==o?void 0:o.message}`,details:`${null!==(l=null==o?void 0:o.stack)&&void 0!==l?l:""}`,hint:"",code:`${null!==(c=null==o?void 0:o.code)&&void 0!==c?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(r,e)}}class et extends Ye{select(r){let e=!1;const t=(null!=r?r:"*").split("").map(n=>/\s/.test(n)&&!e?"":('"'===n&&(e=!e),n)).join("");return this.url.searchParams.set("select",t),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(r,{ascending:e=!0,nullsFirst:t,foreignTable:n,referencedTable:s=n}={}){const o=s?`${s}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${r}.${e?"asc":"desc"}${void 0===t?"":t?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:e,referencedTable:t=e}={}){return this.url.searchParams.set(typeof t>"u"?"limit":`${t}.limit`,`${r}`),this}range(r,e,{foreignTable:t,referencedTable:n=t}={}){const o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(typeof n>"u"?"offset":`${n}.offset`,`${r}`),this.url.searchParams.set(o,""+(e-r+1)),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="GET"===this.method?"application/json":"application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:r=!1,verbose:e=!1,settings:t=!1,buffers:n=!1,wal:s=!1,format:o="text"}={}){var a;const l=[r?"analyze":null,e?"verbose":null,t?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=null!==(a=this.headers.Accept)&&void 0!==a?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${c}"; options=${l};`,this}rollback(){var r;return(null!==(r=this.headers.Prefer)&&void 0!==r?r:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class B extends et{eq(r,e){return this.url.searchParams.append(r,`eq.${e}`),this}neq(r,e){return this.url.searchParams.append(r,`neq.${e}`),this}gt(r,e){return this.url.searchParams.append(r,`gt.${e}`),this}gte(r,e){return this.url.searchParams.append(r,`gte.${e}`),this}lt(r,e){return this.url.searchParams.append(r,`lt.${e}`),this}lte(r,e){return this.url.searchParams.append(r,`lte.${e}`),this}like(r,e){return this.url.searchParams.append(r,`like.${e}`),this}likeAllOf(r,e){return this.url.searchParams.append(r,`like(all).{${e.join(",")}}`),this}likeAnyOf(r,e){return this.url.searchParams.append(r,`like(any).{${e.join(",")}}`),this}ilike(r,e){return this.url.searchParams.append(r,`ilike.${e}`),this}ilikeAllOf(r,e){return this.url.searchParams.append(r,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(r,e){return this.url.searchParams.append(r,`ilike(any).{${e.join(",")}}`),this}is(r,e){return this.url.searchParams.append(r,`is.${e}`),this}in(r,e){const t=e.map(n=>"string"==typeof n&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(r,`in.(${t})`),this}contains(r,e){return"string"==typeof e?this.url.searchParams.append(r,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cs.{${e.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(e)}`),this}containedBy(r,e){return"string"==typeof e?this.url.searchParams.append(r,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cd.{${e.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(e)}`),this}rangeGt(r,e){return this.url.searchParams.append(r,`sr.${e}`),this}rangeGte(r,e){return this.url.searchParams.append(r,`nxl.${e}`),this}rangeLt(r,e){return this.url.searchParams.append(r,`sl.${e}`),this}rangeLte(r,e){return this.url.searchParams.append(r,`nxr.${e}`),this}rangeAdjacent(r,e){return this.url.searchParams.append(r,`adj.${e}`),this}overlaps(r,e){return this.url.searchParams.append(r,"string"==typeof e?`ov.${e}`:`ov.{${e.join(",")}}`),this}textSearch(r,e,{config:t,type:n}={}){let s="";return"plain"===n?s="pl":"phrase"===n?s="ph":"websearch"===n&&(s="w"),this.url.searchParams.append(r,`${s}fts${void 0===t?"":`(${t})`}.${e}`),this}match(r){return Object.entries(r).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(r,e,t){return this.url.searchParams.append(r,`not.${e}.${t}`),this}or(r,{foreignTable:e,referencedTable:t=e}={}){return this.url.searchParams.append(t?`${t}.or`:"or",`(${r})`),this}filter(r,e,t){return this.url.searchParams.append(r,`${e}.${t}`),this}}class tt{constructor(r,{headers:e={},schema:t,fetch:n}){this.url=r,this.headers=e,this.schema=t,this.fetch=n}select(r,{head:e=!1,count:t}={}){const n=e?"HEAD":"GET";let s=!1;const o=(null!=r?r:"*").split("").map(a=>/\s/.test(a)&&!s?"":('"'===a&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),t&&(this.headers.Prefer=`count=${t}`),new B({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(r,{count:e,defaultToNull:t=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),e&&s.push(`count=${e}`),t||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(r)){const o=r.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new B({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}upsert(r,{onConflict:e,ignoreDuplicates:t=!1,count:n,defaultToNull:s=!0}={}){const a=[`resolution=${t?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),n&&a.push(`count=${n}`),s||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(r)){const l=r.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new B({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}update(r,{count:e}={}){const n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),e&&n.push(`count=${e}`),this.headers.Prefer=n.join(","),new B({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}delete({count:r}={}){const t=[];return r&&t.push(`count=${r}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new B({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const rt={"X-Client-Info":"postgrest-js/1.9.0"};class fe{constructor(r,{headers:e={},schema:t,fetch:n}={}){this.url=r,this.headers=Object.assign(Object.assign({},rt),e),this.schemaName=t,this.fetch=n}from(r){const e=new URL(`${this.url}/${r}`);return new tt(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(r){return new fe(this.url,{headers:this.headers,schema:r,fetch:this.fetch})}rpc(r,e={},{head:t=!1,count:n}={}){let s;const o=new URL(`${this.url}/rpc/${r}`);let a;t?(s="HEAD",Object.entries(e).forEach(([c,u])=>{o.searchParams.append(c,`${u}`)})):(s="POST",a=e);const l=Object.assign({},this.headers);return n&&(l.Prefer=`count=${n}`),new B({method:s,url:o,headers:l,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}}var nt=w(6624);const st={"X-Client-Info":"realtime-js/2.8.4"};var oe=function(i){return i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed",i}(oe||{}),E=function(i){return i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving",i}(E||{}),P=function(i){return i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token",i}(P||{}),Ie=function(i){return i.websocket="websocket",i}(Ie||{}),G=function(i){return i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed",i}(G||{});class Le{constructor(r,e){this.callback=r,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class at{constructor(){this.HEADER_LENGTH=1}decode(r,e){return r.constructor===ArrayBuffer?e(this._binaryDecode(r)):e("string"==typeof r?JSON.parse(r):{})}_binaryDecode(r){const e=new DataView(r),t=new TextDecoder;return this._decodeBroadcast(r,e,t)}_decodeBroadcast(r,e,t){const n=e.getUint8(1),s=e.getUint8(2);let o=this.HEADER_LENGTH+2;const a=t.decode(r.slice(o,o+n));o+=n;const l=t.decode(r.slice(o,o+s));return o+=s,{ref:null,topic:a,event:l,payload:JSON.parse(t.decode(r.slice(o,r.byteLength)))}}}class ge{constructor(r,e,t={},n=1e4){this.channel=r,this.event=e,this.payload=t,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,e){var t;return this._hasReceived(r)&&e(null===(t=this.receivedResp)||void 0===t?void 0:t.response),this.recHooks.push({status:r,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(r,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:e}){this.recHooks.filter(t=>t.status===r).forEach(t=>t.callback(e))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}class te{constructor(r,e){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const t=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(t.state,{},n=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=te.syncState(this.state,n,s,o),this.pendingDiffs.forEach(l=>{this.state=te.syncDiff(this.state,l,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(t.diff,{},n=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=te.syncDiff(this.state,n,s,o),a())}),this.onJoin((n,s,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:s,newPresences:o})}),this.onLeave((n,s,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,e,t,n){const s=this.cloneDeep(r),o=this.transformState(e),a={},l={};return this.map(s,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=s[c];if(d){const g=u.map(m=>m.presence_ref),p=d.map(m=>m.presence_ref),f=u.filter(m=>p.indexOf(m.presence_ref)<0),_=d.filter(m=>g.indexOf(m.presence_ref)<0);f.length>0&&(a[c]=f),_.length>0&&(l[c]=_)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},t,n)}static syncDiff(r,e,t,n){const{joins:s,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return t||(t=()=>{}),n||(n=()=>{}),this.map(s,(a,l)=>{var c;const u=null!==(c=r[a])&&void 0!==c?c:[];if(r[a]=this.cloneDeep(l),u.length>0){const d=r[a].map(p=>p.presence_ref),g=u.filter(p=>d.indexOf(p.presence_ref)<0);r[a].unshift(...g)}t(a,u,l)}),this.map(o,(a,l)=>{let c=r[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),r[a]=c,n(a,c,l),0===c.length&&delete r[a]}),r}static map(r,e){return Object.getOwnPropertyNames(r).map(t=>e(t,r[t]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((e,t)=>{const n=r[t];return e[t]="metas"in n?n.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n,e},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var b=function(i){return i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange",i}(b||{});const Ue=(i,r,e={})=>{var t;const n=null!==(t=e.skipTypes)&&void 0!==t?t:[];return Object.keys(r).reduce((s,o)=>(s[o]=ct(o,i,r,n),s),{})},ct=(i,r,e,t)=>{const n=r.find(a=>a.name===i),s=null==n?void 0:n.type,o=e[i];return s&&!t.includes(s)?De(s,o):pe(o)},De=(i,r)=>{if("_"===i.charAt(0)){const e=i.slice(1,i.length);return ft(r,e)}switch(i){case b.bool:return ut(r);case b.float4:case b.float8:case b.int2:case b.int4:case b.int8:case b.numeric:case b.oid:return ht(r);case b.json:case b.jsonb:return dt(r);case b.timestamp:return gt(r);default:return pe(r)}},pe=i=>i,ut=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},ht=i=>{if("string"==typeof i){const r=parseFloat(i);if(!Number.isNaN(r))return r}return i},dt=i=>{if("string"==typeof i)try{return JSON.parse(i)}catch(r){return console.log(`JSON parse error: ${r}`),i}return i},ft=(i,r)=>{if("string"!=typeof i)return i;const e=i.length-1;if("{"===i[0]&&"}"===i[e]){let s;const o=i.slice(1,e);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>De(r,a))}return i},gt=i=>"string"==typeof i?i.replace(" ","T"):i;class _e{constructor(r,e={config:{}},t){this.topic=r,this.params=e,this.socket=t,this.bindings={},this.state=E.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},e.config),this.timeout=this.socket.timeout,this.joinPush=new ge(this,P.join,this.params,this.timeout),this.rejoinTimer=new Le(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=E.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=E.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=E.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=E.errored,this.rejoinTimer.scheduleTimeout())}),this._on(P.reply,{},(n,s)=>{this._trigger(this._replyEventName(s),n)}),this.presence=new te(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(r,e=this.timeout){var t,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:s,presence:o}}=this.params;this._onError(c=>r&&r("CHANNEL_ERROR",c)),this._onClose(()=>r&&r("CLOSED"));const a={},l={broadcast:s,presence:o,postgres_changes:null!==(n=null===(t=this.bindings.postgres_changes)||void 0===t?void 0:t.map(c=>c.filter))&&void 0!==n?n:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",({postgres_changes:c})=>{var u;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==c){const d=this.bindings.postgres_changes,g=null!==(u=null==d?void 0:d.length)&&void 0!==u?u:0,p=[];for(let f=0;f<g;f++){const _=d[f],{filter:{event:m,schema:k,table:O,filter:j}}=_,T=c&&c[f];if(!T||T.event!==m||T.schema!==k||T.table!==O||T.filter!==j)return this.unsubscribe(),void(r&&r("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));p.push(Object.assign(Object.assign({},_),{id:T.id}))}return this.bindings.postgres_changes=p,void(r&&r("SUBSCRIBED"))}r&&r("SUBSCRIBED")}).receive("error",c=>{r&&r("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{r&&r("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(r,e={}){var t=this;return(0,h.Z)(function*(){return yield t.send({type:"presence",event:"track",payload:r},e.timeout||t.timeout)})()}untrack(r={}){var e=this;return(0,h.Z)(function*(){return yield e.send({type:"presence",event:"untrack"},r)})()}on(r,e,t){return this._on(r,e,t)}send(r,e={}){var t=this;return(0,h.Z)(function*(){var n,s;if(t._canPush()||"broadcast"!==r.type)return new Promise(o=>{var a,l,c;const u=t._push(r.type,r,e.timeout||t.timeout);"broadcast"===r.type&&!(null!==(c=null===(l=null===(a=t.params)||void 0===a?void 0:a.config)||void 0===l?void 0:l.broadcast)&&void 0!==c&&c.ack)&&o("ok"),u.receive("ok",()=>o("ok")),u.receive("timeout",()=>o("timed out"))});{const{event:o,payload:a}=r,l={method:"POST",headers:{apikey:null!==(n=t.socket.accessToken)&&void 0!==n?n:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:t.subTopic,event:o,payload:a}]})};try{return(yield t._fetchWithTimeout(t.broadcastEndpointURL,l,null!==(s=e.timeout)&&void 0!==s?s:t.timeout)).ok?"ok":"error"}catch(c){return"AbortError"===c.name?"timed out":"error"}}})()}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=E.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(P.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(t=>{const n=new ge(this,P.leave,{},r);n.receive("ok",()=>{e(),t("ok")}).receive("timeout",()=>{e(),t("timed out")}).receive("error",()=>{t("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}_broadcastEndpointURL(){let r=this.socket.endPoint;return r=r.replace(/^ws/i,"http"),r=r.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),r.replace(/\/+$/,"")+"/api/broadcast"}_fetchWithTimeout(r,e,t){var n=this;return(0,h.Z)(function*(){const s=new AbortController,o=setTimeout(()=>s.abort(),t),a=yield n.socket.fetch(r,Object.assign(Object.assign({},e),{signal:s.signal}));return clearTimeout(o),a})()}_push(r,e,t=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new ge(this,r,e,t);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(r,e,t){return e}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,e,t){var n,s;const o=r.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=P;if(t&&[a,l,c,u].indexOf(o)>=0&&t!==this._joinRef())return;let g=this._onMessage(o,e,t);if(e&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(p=>{var f,_,m;return"*"===(null===(f=p.filter)||void 0===f?void 0:f.event)||(null===(m=null===(_=p.filter)||void 0===_?void 0:_.event)||void 0===m?void 0:m.toLocaleLowerCase())===o}).map(p=>p.callback(g,t)):null===(s=this.bindings[o])||void 0===s||s.filter(p=>{var f,_,m,k,O,j;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in p){const T=p.id,J=null===(f=p.filter)||void 0===f?void 0:f.event;return T&&(null===(_=e.ids)||void 0===_?void 0:_.includes(T))&&("*"===J||(null==J?void 0:J.toLocaleLowerCase())===(null===(m=e.data)||void 0===m?void 0:m.type.toLocaleLowerCase()))}{const T=null===(O=null===(k=null==p?void 0:p.filter)||void 0===k?void 0:k.event)||void 0===O?void 0:O.toLocaleLowerCase();return"*"===T||T===(null===(j=null==e?void 0:e.event)||void 0===j?void 0:j.toLocaleLowerCase())}}return p.type.toLocaleLowerCase()===o}).map(p=>{if("object"==typeof g&&"ids"in g){const f=g.data,{schema:_,table:m,commit_timestamp:k,type:O,errors:j}=f;g=Object.assign(Object.assign({},{schema:_,table:m,commit_timestamp:k,eventType:O,new:{},old:{},errors:j}),this._getPayloadRecords(f))}p.callback(g,t)})}_isClosed(){return this.state===E.closed}_isJoined(){return this.state===E.joined}_isJoining(){return this.state===E.joining}_isLeaving(){return this.state===E.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,e,t){const n=r.toLocaleLowerCase(),s={type:n,filter:e,callback:t};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(r,e){const t=r.toLocaleLowerCase();return this.bindings[t]=this.bindings[t].filter(n=>{var s;return!((null===(s=n.type)||void 0===s?void 0:s.toLocaleLowerCase())===t&&_e.isEqual(n.filter,e))}),this}static isEqual(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(r[t]!==e[t])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(P.close,{},r)}_onError(r){this._on(P.error,{},e=>r(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=E.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const e={new:{},old:{}};return("INSERT"===r.type||"UPDATE"===r.type)&&(e.new=Ue(r.columns,r.record)),("UPDATE"===r.type||"DELETE"===r.type)&&(e.old=Ue(r.columns,r.old_record)),e}}const yt=()=>{};class mt{constructor(r,e){var n,t=this;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=st,this.params={},this.timeout=1e4,this.transport=nt.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=yt,this.conn=null,this.sendBuffer=[],this.serializer=new at,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=o=>{let a;return a=o||(typeof fetch>"u"?(...l)=>Promise.resolve().then(w.bind(w,9470)).then(({default:c})=>c(...l)):fetch),(...l)=>a(...l)},this.endPoint=`${r}/${Ie.websocket}`,null!=e&&e.params&&(this.params=e.params),null!=e&&e.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),null!=e&&e.timeout&&(this.timeout=e.timeout),null!=e&&e.logger&&(this.logger=e.logger),null!=e&&e.transport&&(this.transport=e.transport),null!=e&&e.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const s=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.apikey;s&&(this.accessToken=s),this.reconnectAfterMs=null!=e&&e.reconnectAfterMs?e.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=null!=e&&e.encode?e.encode:(o,a)=>a(JSON.stringify(o)),this.decode=null!=e&&e.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Le((0,h.Z)(function*(){t.disconnect(),t.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==e?void 0:e.fetch)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r)))}disconnect(r,e){this.conn&&(this.conn.onclose=function(){},r?this.conn.close(r,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(r){var e=this;return(0,h.Z)(function*(){const t=yield r.unsubscribe();return 0===e.channels.length&&e.disconnect(),t})()}removeAllChannels(){var r=this;return(0,h.Z)(function*(){const e=yield Promise.all(r.channels.map(t=>t.unsubscribe()));return r.disconnect(),e})()}log(r,e,t){this.logger(r,e,t)}connectionState(){switch(this.conn&&this.conn.readyState){case oe.connecting:return G.Connecting;case oe.open:return G.Open;case oe.closing:return G.Closing;default:return G.Closed}}isConnected(){return this.connectionState()===G.Open}channel(r,e={config:{}}){const t=new _e(`realtime:${r}`,e,this);return this.channels.push(t),t}push(r){const{topic:e,event:t,payload:n,ref:s}=r,o=()=>{this.encode(r,a=>{var l;null===(l=this.conn)||void 0===l||l.send(a)})};this.log("push",`${e} ${t} (${s})`,n),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(r){this.accessToken=r,this.channels.forEach(e=>{r&&e.updateJoinPayload({access_token:r}),e.joinedOnce&&e._isJoined()&&e._push(P.access_token,{access_token:r})})}_makeRef(){let r=this.ref+1;return this.ref=r===this.ref?0:r,this.ref.toString()}_leaveOpenTopic(r){let e=this.channels.find(t=>t.topic===r&&(t._isJoined()||t._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${r}"`),e.unsubscribe())}_remove(r){this.channels=this.channels.filter(e=>e._joinRef()!==r._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(r){this.decode(r.data,e=>{let{topic:t,event:n,payload:s,ref:o}=e;(o&&o===this.pendingHeartbeatRef||n===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${n} ${o&&"("+o+")"||""}`,s),this.channels.filter(a=>a._isMember(t)).forEach(a=>a._trigger(n,s,o)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(r=>r())}_onConnClose(r){this.log("transport","close",r),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(r))}_onConnError(r){this.log("transport",r.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(r))}_triggerChanError(){this.channels.forEach(r=>r._trigger(P.error))}_appendParams(r,e){if(0===Object.keys(e).length)return r;const t=r.match(/\?/)?"&":"?";return`${r}${t}${new URLSearchParams(e)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_sendHeartbeat(){var r;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(r=this.conn)||void 0===r||r.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class ve extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function x(i){return"object"==typeof i&&null!==i&&"__isStorageError"in i}class bt extends ve{constructor(r,e){super(r),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ze extends ve{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}}const Ne=i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(w.bind(w,9470)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)};var H=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(u){try{c(t.next(u))}catch(d){o(d)}}function l(u){try{c(t.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(u.value).then(a,l)}c((t=t.apply(i,r||[])).next())})};const ye=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),St=(i,r)=>H(void 0,void 0,void 0,function*(){const e=yield function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(u){try{c(t.next(u))}catch(d){o(d)}}function l(u){try{c(t.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(u.value).then(a,l)}c((t=t.apply(i,r||[])).next())})}(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(w.bind(w,9470))).Response:Response});i instanceof e?i.json().then(t=>{r(new bt(ye(t),i.status||500))}).catch(t=>{r(new Ze(ye(t),t))}):r(new Ze(ye(i),i))}),xt=(i,r,e,t)=>{const n={method:i,headers:(null==r?void 0:r.headers)||{}};return"GET"===i?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==r?void 0:r.headers),n.body=JSON.stringify(t),Object.assign(Object.assign({},n),e))};function ae(i,r,e,t,n,s){return H(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(e,xt(r,t,n,s)).then(l=>{if(!l.ok)throw l;return null!=t&&t.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>St(l,a))})})}function me(i,r,e,t){return H(this,void 0,void 0,function*(){return ae(i,"GET",r,e,t)})}function U(i,r,e,t,n){return H(this,void 0,void 0,function*(){return ae(i,"POST",r,t,n,e)})}function Ot(i,r,e,t,n){return H(this,void 0,void 0,function*(){return ae(i,"PUT",r,t,n,e)})}function Fe(i,r,e,t,n){return H(this,void 0,void 0,function*(){return ae(i,"DELETE",r,t,n,e)})}var $=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(u){try{c(t.next(u))}catch(d){o(d)}}function l(u){try{c(t.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(u.value).then(a,l)}c((t=t.apply(i,r||[])).next())})};const Tt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},qe={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class jt{constructor(r,e={},t,n){this.url=r,this.headers=e,this.bucketId=t,this.fetch=Ne(n)}uploadOrUpdate(r,e,t,n){return $(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},qe),n),a=Object.assign(Object.assign({},this.headers),"POST"===r&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&t instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),s.append("",t)):typeof FormData<"u"&&t instanceof FormData?(s=t,s.append("cacheControl",o.cacheControl)):(s=t,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const l=this._removeEmptyFolders(e),c=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:r,body:s,headers:a},null!=o&&o.duplex?{duplex:o.duplex}:{}));return u.ok?{data:{path:l},error:null}:{data:null,error:yield u.json()}}catch(s){if(x(s))return{data:null,error:s};throw s}})}upload(r,e,t){return $(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,e,t)})}uploadToSignedUrl(r,e,t,n){return $(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(r),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const c=Object.assign({upsert:qe.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",c.cacheControl)):(l=t,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u});return d.ok?{data:{path:s},error:null}:{data:null,error:yield d.json()}}catch(l){if(x(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(r){return $(this,void 0,void 0,function*(){try{let e=this._getFinalPath(r);const t=yield U(this.fetch,`${this.url}/object/upload/sign/${e}`,{},{headers:this.headers}),n=new URL(this.url+t.url),s=n.searchParams.get("token");if(!s)throw new ve("No token returned by API");return{data:{signedUrl:n.toString(),path:r,token:s},error:null}}catch(e){if(x(e))return{data:null,error:e};throw e}})}update(r,e,t){return $(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,e,t)})}move(r,e){return $(this,void 0,void 0,function*(){try{return{data:yield U(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}copy(r,e){return $(this,void 0,void 0,function*(){try{return{data:{path:(yield U(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e},{headers:this.headers})).Key},error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}createSignedUrl(r,e,t){return $(this,void 0,void 0,function*(){try{let n=this._getFinalPath(r),s=yield U(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:e},null!=t&&t.transform?{transform:t.transform}:{}),{headers:this.headers});const o=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}createSignedUrls(r,e,t){return $(this,void 0,void 0,function*(){try{const n=yield U(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:r},{headers:this.headers}),s=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}download(r,e){return $(this,void 0,void 0,function*(){const n=typeof(null==e?void 0:e.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),o=s?`?${s}`:"";try{const a=this._getFinalPath(r);return{data:yield(yield me(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(x(a))return{data:null,error:a};throw a}})}getPublicUrl(r,e){const t=this._getFinalPath(r),n=[],s=null!=e&&e.download?`download=${!0===e.download?"":e.download}`:"";""!==s&&n.push(s);const a=typeof(null==e?void 0:e.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==l&&n.push(l);let c=n.join("&");return""!==c&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${t}${c}`)}}}remove(r){return $(this,void 0,void 0,function*(){try{return{data:yield Fe(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(e){if(x(e))return{data:null,error:e};throw e}})}list(r,e,t){return $(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Tt),e),{prefix:r||""});return{data:yield U(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}_getFinalPath(r){return`${this.bucketId}/${r}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}}const Et={"X-Client-Info":"storage-js/2.5.4"};var K=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(u){try{c(t.next(u))}catch(d){o(d)}}function l(u){try{c(t.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(u.value).then(a,l)}c((t=t.apply(i,r||[])).next())})};class $t{constructor(r,e={},t){this.url=r,this.headers=Object.assign(Object.assign({},Et),e),this.fetch=Ne(t)}listBuckets(){return K(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(x(r))return{data:null,error:r};throw r}})}getBucket(r){return K(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(e){if(x(e))return{data:null,error:e};throw e}})}createBucket(r,e={public:!1}){return K(this,void 0,void 0,function*(){try{return{data:yield U(this.fetch,`${this.url}/bucket`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}updateBucket(r,e){return K(this,void 0,void 0,function*(){try{return{data:yield Ot(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}emptyBucket(r){return K(this,void 0,void 0,function*(){try{return{data:yield U(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(x(e))return{data:null,error:e};throw e}})}deleteBucket(r){return K(this,void 0,void 0,function*(){try{return{data:yield Fe(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(e){if(x(e))return{data:null,error:e};throw e}})}}class At extends $t{constructor(r,e={},t){super(r,e,t)}from(r){return new jt(this.url,this.headers,r,this.fetch)}}let re="";re=typeof Deno<"u"?"deno":typeof document<"u"?"web":typeof navigator<"u"&&"ReactNative"===navigator.product?"react-native":"node";const Pt={"X-Client-Info":`supabase-js-${re}/2.38.5`};const Ut=(i,r,e)=>{const t=(i=>{let r;return r=i||(typeof fetch>"u"?de.default:fetch),(...e)=>r(...e)})(e),n=typeof Headers>"u"?de.Headers:Headers;return(s,o)=>function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(u){try{c(t.next(u))}catch(d){o(d)}}function l(u){try{c(t.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(u.value).then(a,l)}c((t=t.apply(i,r||[])).next())})}(void 0,void 0,void 0,function*(){var a;const l=null!==(a=yield r())&&void 0!==a?a:i;let c=new n(null==o?void 0:o.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),t(s,Object.assign(Object.assign({},o),{headers:c}))})},L=()=>typeof document<"u",F={tested:!1,writable:!1},ne=()=>{if(!L())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch{return!1}if(F.tested)return F.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),F.tested=!0,F.writable=!0}catch{F.tested=!0,F.writable=!1}return F.writable};function be(i){const r={},e=new URL(i);if(e.hash&&"#"===e.hash[0])try{new URLSearchParams(e.hash.substring(1)).forEach((n,s)=>{r[s]=n})}catch{}return e.searchParams.forEach((t,n)=>{r[n]=t}),r}const Je=i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(w.bind(w,9470)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)},qt=i=>"object"==typeof i&&null!==i&&"status"in i&&"ok"in i&&"json"in i&&"function"==typeof i.json,q=function(){var i=(0,h.Z)(function*(r,e,t){yield r.setItem(e,JSON.stringify(t))});return function(e,t,n){return i.apply(this,arguments)}}(),le=function(){var i=(0,h.Z)(function*(r,e){const t=yield r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}});return function(e,t){return i.apply(this,arguments)}}(),we=function(){var i=(0,h.Z)(function*(r,e){yield r.removeItem(e)});return function(e,t){return i.apply(this,arguments)}}();class ce{constructor(){this.promise=new ce.promiseConstructor((r,e)=>{this.resolve=r,this.reject=e})}}function Me(i){const e=i.split(".");if(3!==e.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");return JSON.parse(function Jt(i){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t,n,s,o,a,l,c,e="",u=0;for(i=i.replace("-","+").replace("_","/");u<i.length;)o=r.indexOf(i.charAt(u++)),a=r.indexOf(i.charAt(u++)),l=r.indexOf(i.charAt(u++)),c=r.indexOf(i.charAt(u++)),t=o<<2|a>>4,n=(15&a)<<4|l>>2,s=(3&l)<<6|c,e+=String.fromCharCode(t),64!=l&&0!=n&&(e+=String.fromCharCode(n)),64!=c&&0!=s&&(e+=String.fromCharCode(s));return e}(e[1]))}function ke(){return(ke=(0,h.Z)(function*(i){return yield new Promise(r=>{setTimeout(()=>r(null),i)})})).apply(this,arguments)}function Bt(i){return("0"+i.toString(16)).substr(-2)}function V(){const r=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let s=0;s<56;s++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(r),Array.from(r,Bt).join("")}function Se(){return(Se=(0,h.Z)(function*(i){const e=(new TextEncoder).encode(i),t=yield crypto.subtle.digest("SHA-256",e),n=new Uint8Array(t);return Array.from(n).map(s=>String.fromCharCode(s)).join("")})).apply(this,arguments)}function W(i){return xe.apply(this,arguments)}function xe(){return xe=(0,h.Z)(function*(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const e=yield function Gt(i){return Se.apply(this,arguments)}(i);return function Ht(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(e)}),xe.apply(this,arguments)}ce.promiseConstructor=Promise;class Oe extends Error{constructor(r,e){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=e}}function v(i){return"object"==typeof i&&null!==i&&"__isAuthError"in i}class Kt extends Oe{constructor(r,e){super(r,e),this.name="AuthApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ze extends Oe{constructor(r,e){super(r),this.name="AuthUnknownError",this.originalError=e}}class X extends Oe{constructor(r,e,t){super(r),this.name=e,this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Q extends X{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Te extends X{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class ue extends X{constructor(r){super(r,"AuthInvalidCredentialsError",400)}}class he extends X{constructor(r,e=null){super(r,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Be extends X{constructor(r,e=null){super(r,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class je extends X{constructor(r,e){super(r,"AuthRetryableFetchError",e)}}function Ge(i){return v(i)&&"AuthRetryableFetchError"===i.name}const se=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Xt=[502,503,504];function He(i){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,h.Z)(function*(i){if(!qt(i))throw new je(se(i),0);if(Xt.includes(i.status))throw new je(se(i),i.status);let r;try{r=yield i.json()}catch(e){throw new ze(se(e),e)}throw new Kt(se(r),i.status||500)})).apply(this,arguments)}const Qt=(i,r,e,t)=>{const n={method:i,headers:(null==r?void 0:r.headers)||{}};return"GET"===i?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==r?void 0:r.headers),n.body=JSON.stringify(t),Object.assign(Object.assign({},n),e))};function y(i,r,e,t){return $e.apply(this,arguments)}function $e(){return $e=(0,h.Z)(function*(i,r,e,t){var n;const s=Object.assign({},null==t?void 0:t.headers);null!=t&&t.jwt&&(s.Authorization=`Bearer ${t.jwt}`);const o=null!==(n=null==t?void 0:t.query)&&void 0!==n?n:{};null!=t&&t.redirectTo&&(o.redirect_to=t.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield function Yt(i,r,e,t,n,s){return Ae.apply(this,arguments)}(i,r,e+a,{headers:s,noResolveJson:null==t?void 0:t.noResolveJson},{},null==t?void 0:t.body);return null!=t&&t.xform?null==t?void 0:t.xform(l):{data:Object.assign({},l),error:null}}),$e.apply(this,arguments)}function Ae(){return(Ae=(0,h.Z)(function*(i,r,e,t,n,s){const o=Qt(r,t,n,s);let a;try{a=yield i(e,o)}catch(l){throw console.error(l),new je(se(l),0)}if(a.ok||(yield He(a)),null!=t&&t.noResolveJson)return a;try{return yield a.json()}catch(l){yield He(l)}})).apply(this,arguments)}function D(i){var r;let e=null;return function nr(i){return i.access_token&&i.refresh_token&&i.expires_in}(i)&&(e=Object.assign({},i),i.expires_at||(e.expires_at=function Nt(i){return Math.round(Date.now()/1e3)+i}(i.expires_in))),{data:{session:e,user:null!==(r=i.user)&&void 0!==r?r:i},error:null}}function Z(i){var r;return{data:{user:null!==(r=i.user)&&void 0!==r?r:i},error:null}}function er(i){return{data:i,error:null}}function tr(i){const{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:s}=i,o=function(i,r){var e={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&r.indexOf(t)<0&&(e[t]=i[t]);if(null!=i&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(i);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(i,t[n])&&(e[t[n]]=i[t[n]])}return e}(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:s},user:Object.assign({},o)},error:null}}function rr(i){return i}class ir{constructor({url:r="",headers:e={},fetch:t}){this.url=r,this.headers=e,this.fetch=Je(t),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(r,e="global"){var t=this;return(0,h.Z)(function*(){try{return yield y(t.fetch,"POST",`${t.url}/logout?scope=${e}`,{headers:t.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(n){if(v(n))return{data:null,error:n};throw n}})()}inviteUserByEmail(r,e={}){var t=this;return(0,h.Z)(function*(){try{return yield y(t.fetch,"POST",`${t.url}/invite`,{body:{email:r,data:e.data},headers:t.headers,redirectTo:e.redirectTo,xform:Z})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}generateLink(r){var e=this;return(0,h.Z)(function*(){try{const{options:t}=r,n=function(i,r){var e={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&r.indexOf(t)<0&&(e[t]=i[t]);if(null!=i&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(i);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(i,t[n])&&(e[t[n]]=i[t[n]])}return e}(r,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=null==n?void 0:n.newEmail,delete s.newEmail),yield y(e.fetch,"POST",`${e.url}/admin/generate_link`,{body:s,headers:e.headers,xform:tr,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(v(t))return{data:{properties:null,user:null},error:t};throw t}})()}createUser(r){var e=this;return(0,h.Z)(function*(){try{return yield y(e.fetch,"POST",`${e.url}/admin/users`,{body:r,headers:e.headers,xform:Z})}catch(t){if(v(t))return{data:{user:null},error:t};throw t}})()}listUsers(r){var e=this;return(0,h.Z)(function*(){var t,n,s,o,a,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=yield y(e.fetch,"GET",`${e.url}/admin/users`,{headers:e.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==r?void 0:r.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(o=null===(s=null==r?void 0:r.perPage)||void 0===s?void 0:s.toString())&&void 0!==o?o:""},xform:rr});if(d.error)throw d.error;const g=yield d.json(),p=null!==(a=d.headers.get("x-total-count"))&&void 0!==a?a:0,f=null!==(c=null===(l=d.headers.get("link"))||void 0===l?void 0:l.split(","))&&void 0!==c?c:[];return f.length>0&&(f.forEach(_=>{const m=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),k=JSON.parse(_.split(";")[1].split("=")[1]);u[`${k}Page`]=m}),u.total=parseInt(p)),{data:Object.assign(Object.assign({},g),u),error:null}}catch(u){if(v(u))return{data:{users:[]},error:u};throw u}})()}getUserById(r){var e=this;return(0,h.Z)(function*(){try{return yield y(e.fetch,"GET",`${e.url}/admin/users/${r}`,{headers:e.headers,xform:Z})}catch(t){if(v(t))return{data:{user:null},error:t};throw t}})()}updateUserById(r,e){var t=this;return(0,h.Z)(function*(){try{return yield y(t.fetch,"PUT",`${t.url}/admin/users/${r}`,{body:e,headers:t.headers,xform:Z})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}deleteUser(r,e=!1){var t=this;return(0,h.Z)(function*(){try{return yield y(t.fetch,"DELETE",`${t.url}/admin/users/${r}`,{headers:t.headers,body:{should_soft_delete:e},xform:Z})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}_listFactors(r){var e=this;return(0,h.Z)(function*(){try{const{data:t,error:n}=yield y(e.fetch,"GET",`${e.url}/admin/users/${r.userId}/factors`,{headers:e.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(v(t))return{data:null,error:t};throw t}})()}_deleteFactor(r){var e=this;return(0,h.Z)(function*(){try{return{data:yield y(e.fetch,"DELETE",`${e.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:e.headers}),error:null}}catch(t){if(v(t))return{data:null,error:t};throw t}})()}}const cr={getItem:i=>ne()?globalThis.localStorage.getItem(i):null,setItem:(i,r)=>{ne()&&globalThis.localStorage.setItem(i,r)},removeItem:i=>{ne()&&globalThis.localStorage.removeItem(i)}};function We(i={}){return{getItem:r=>i[r]||null,setItem:(r,e)=>{i[r]=e},removeItem:r=>{delete i[r]}}}globalThis&&ne()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug");class hr extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}!function ur(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}();const fr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:{"X-Client-Info":"gotrue-js/2.57.0"},flowType:"implicit",debug:!1},ie=3e4;function gr(i,r,e){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,h.Z)(function*(i,r,e){return yield e()})).apply(this,arguments)}let pr=(()=>{class i{constructor(e){var n,t=this;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=i.nextInstanceID,i.nextInstanceID+=1,this.instanceID>0&&L()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},fr),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new ir({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Je(s.fetch),this.lock=s.lock||gr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:ne()?this.storage=cr:(this.memoryStorage={},this.storage=We(this.memoryStorage)):(this.memoryStorage={},this.storage=We(this.memoryStorage)),L()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",function(){var o=(0,h.Z)(function*(a){t._debug("received broadcast notification from other tab or client",a),yield t._notifyAllSubscribers(a.data.event,a.data.session,!1)});return function(a){return o.apply(this,arguments)}}())}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (2.57.0) ${(new Date).toISOString()}`,...e),this}initialize(){var e=this;return(0,h.Z)(function*(){return e.initializePromise||(e.initializePromise=(0,h.Z)(function*(){return yield e._acquireLock(-1,(0,h.Z)(function*(){return yield e._initialize()}))})()),yield e.initializePromise})()}_initialize(){var e=this;return(0,h.Z)(function*(){try{const t=!!L()&&(yield e._isPKCEFlow());if(e._debug("#_initialize()","begin","is PKCE flow",t),t||e.detectSessionInUrl&&e._isImplicitGrantFlow()){const{data:n,error:s}=yield e._getSessionFromURL(t);if(s)return e._debug("#_initialize()","error detecting session from URL",s),yield e._removeSession(),{error:s};const{session:o,redirectType:a}=n;return e._debug("#_initialize()","detected session in URL",o,"redirect type",a),yield e._saveSession(o),setTimeout((0,h.Z)(function*(){"recovery"===a?yield e._notifyAllSubscribers("PASSWORD_RECOVERY",o):yield e._notifyAllSubscribers("SIGNED_IN",o)}),0),{error:null}}return yield e._recoverAndRefresh(),{error:null}}catch(t){return v(t)?{error:t}:{error:new ze("Unexpected error during initialization",t)}}finally{yield e._handleVisibilityChange(),e._debug("#_initialize()","end")}})()}signUp(e){var t=this;return(0,h.Z)(function*(){var n,s,o;try{let a;if(yield t._removeSession(),"email"in e){const{email:g,password:p,options:f}=e;let _=null,m=null;if("pkce"===t.flowType){const k=V();yield q(t.storage,`${t.storageKey}-code-verifier`,k),_=yield W(k),m=k===_?"plain":"s256"}a=yield y(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,redirectTo:null==f?void 0:f.emailRedirectTo,body:{email:g,password:p,data:null!==(n=null==f?void 0:f.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken},code_challenge:_,code_challenge_method:m},xform:D})}else{if(!("phone"in e))throw new ue("You must provide either an email or phone number and a password");{const{phone:g,password:p,options:f}=e;a=yield y(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,body:{phone:g,password:p,data:null!==(s=null==f?void 0:f.data)&&void 0!==s?s:{},channel:null!==(o=null==f?void 0:f.channel)&&void 0!==o?o:"sms",gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken}},xform:D})}}const{data:l,error:c}=a;if(c||!l)return{data:{user:null,session:null},error:c};const u=l.session,d=l.user;return l.session&&(yield t._saveSession(l.session),yield t._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:d,session:u},error:null}}catch(a){if(v(a))return{data:{user:null,session:null},error:a};throw a}})()}signInWithPassword(e){var t=this;return(0,h.Z)(function*(){try{let n;if(yield t._removeSession(),"email"in e){const{email:a,password:l,options:c}=e;n=yield y(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{email:a,password:l,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken}},xform:D})}else{if(!("phone"in e))throw new ue("You must provide either an email or phone number and a password");{const{phone:a,password:l,options:c}=e;n=yield y(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{phone:a,password:l,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken}},xform:D})}}const{data:s,error:o}=n;return o?{data:{user:null,session:null},error:o}:s&&s.session&&s.user?(s.session&&(yield t._saveSession(s.session),yield t._notifyAllSubscribers("SIGNED_IN",s.session)),{data:{user:s.user,session:s.session},error:o}):{data:{user:null,session:null},error:new Te}}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOAuth(e){var t=this;return(0,h.Z)(function*(){var n,s,o,a;return yield t._removeSession(),yield t._handleProviderSignIn(e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(o=e.options)||void 0===o?void 0:o.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})})()}exchangeCodeForSession(e){var t=this;return(0,h.Z)(function*(){return yield t.initializePromise,t._acquireLock(-1,(0,h.Z)(function*(){return t._exchangeCodeForSession(e)}))})()}_exchangeCodeForSession(e){var t=this;return(0,h.Z)(function*(){const n=yield le(t.storage,`${t.storageKey}-code-verifier`),{data:s,error:o}=yield y(t.fetch,"POST",`${t.url}/token?grant_type=pkce`,{headers:t.headers,body:{auth_code:e,code_verifier:n},xform:D});return yield we(t.storage,`${t.storageKey}-code-verifier`),o?{data:{user:null,session:null},error:o}:s&&s.session&&s.user?(s.session&&(yield t._saveSession(s.session),yield t._notifyAllSubscribers("SIGNED_IN",s.session)),{data:s,error:o}):{data:{user:null,session:null},error:new Te}})()}signInWithIdToken(e){var t=this;return(0,h.Z)(function*(){yield t._removeSession();try{const{options:n,provider:s,token:o,access_token:a,nonce:l}=e,c=yield y(t.fetch,"POST",`${t.url}/token?grant_type=id_token`,{headers:t.headers,body:{provider:s,id_token:o,access_token:a,nonce:l,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:D}),{data:u,error:d}=c;return d?{data:{user:null,session:null},error:d}:u&&u.session&&u.user?(u.session&&(yield t._saveSession(u.session),yield t._notifyAllSubscribers("SIGNED_IN",u.session)),{data:u,error:d}):{data:{user:null,session:null},error:new Te}}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOtp(e){var t=this;return(0,h.Z)(function*(){var n,s,o,a,l;try{if(yield t._removeSession(),"email"in e){const{email:c,options:u}=e;let d=null,g=null;if("pkce"===t.flowType){const f=V();yield q(t.storage,`${t.storageKey}-code-verifier`,f),d=yield W(f),g=f===d?"plain":"s256"}const{error:p}=yield y(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{email:c,data:null!==(n=null==u?void 0:u.data)&&void 0!==n?n:{},create_user:null===(s=null==u?void 0:u.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken},code_challenge:d,code_challenge_method:g},redirectTo:null==u?void 0:u.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){const{phone:c,options:u}=e,{data:d,error:g}=yield y(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{phone:c,data:null!==(o=null==u?void 0:u.data)&&void 0!==o?o:{},create_user:null===(a=null==u?void 0:u.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken},channel:null!==(l=null==u?void 0:u.channel)&&void 0!==l?l:"sms"}});return{data:{user:null,session:null,messageId:null==d?void 0:d.message_id},error:g}}throw new ue("You must provide either an email or phone number.")}catch(c){if(v(c))return{data:{user:null,session:null},error:c};throw c}})()}verifyOtp(e){var t=this;return(0,h.Z)(function*(){var n,s;try{let o,a;"email_change"!==e.type&&"phone_change"!==e.type&&(yield t._removeSession()),"options"in e&&(o=null===(n=e.options)||void 0===n?void 0:n.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:l,error:c}=yield y(t.fetch,"POST",`${t.url}/verify`,{headers:t.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:o,xform:D});if(c)throw c;if(!l)throw new Error("An error occurred on token verification.");const u=l.session,d=l.user;return null!=u&&u.access_token&&(yield t._saveSession(u),yield t._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:d,session:u},error:null}}catch(o){if(v(o))return{data:{user:null,session:null},error:o};throw o}})()}signInWithSSO(e){var t=this;return(0,h.Z)(function*(){var n,s,o;try{yield t._removeSession();let a=null,l=null;if("pkce"===t.flowType){const c=V();yield q(t.storage,`${t.storageKey}-code-verifier`,c),a=yield W(c),l=c===a?"plain":"s256"}return yield y(t.fetch,"POST",`${t.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(n=e.options)||void 0===n?void 0:n.redirectTo)&&void 0!==s?s:void 0}),null!==(o=null==e?void 0:e.options)&&void 0!==o&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:t.headers,xform:er})}catch(a){if(v(a))return{data:null,error:a};throw a}})()}reauthenticate(){var e=this;return(0,h.Z)(function*(){return yield e.initializePromise,yield e._acquireLock(-1,(0,h.Z)(function*(){return yield e._reauthenticate()}))})()}_reauthenticate(){var e=this;return(0,h.Z)(function*(){try{return yield e._useSession(function(){var t=(0,h.Z)(function*(n){const{data:{session:s},error:o}=n;if(o)throw o;if(!s)throw new Q;const{error:a}=yield y(e.fetch,"GET",`${e.url}/reauthenticate`,{headers:e.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}});return function(n){return t.apply(this,arguments)}}())}catch(t){if(v(t))return{data:{user:null,session:null},error:t};throw t}})()}resend(e){var t=this;return(0,h.Z)(function*(){try{"email_change"!=e.type&&"phone_change"!=e.type&&(yield t._removeSession());const n=`${t.url}/resend`;if("email"in e){const{email:s,type:o,options:a}=e,{error:l}=yield y(t.fetch,"POST",n,{headers:t.headers,body:{email:s,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:l}}if("phone"in e){const{phone:s,type:o,options:a}=e,{data:l,error:c}=yield y(t.fetch,"POST",n,{headers:t.headers,body:{phone:s,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==l?void 0:l.message_id},error:c}}throw new ue("You must provide either an email or phone number and a type")}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}getSession(){var e=this;return(0,h.Z)(function*(){return yield e.initializePromise,e._acquireLock(-1,(0,h.Z)(function*(){return e._useSession(function(){var t=(0,h.Z)(function*(n){return n});return function(n){return t.apply(this,arguments)}}())}))})()}_acquireLock(e,t){var n=this;return(0,h.Z)(function*(){n._debug("#_acquireLock","begin",e);try{if(n.lockAcquired){const s=n.pendingInLock.length?n.pendingInLock[n.pendingInLock.length-1]:Promise.resolve(),o=(0,h.Z)(function*(){return yield s,yield t()})();return n.pendingInLock.push((0,h.Z)(function*(){try{yield o}catch{}})()),o}return yield n.lock(`lock:${n.storageKey}`,e,(0,h.Z)(function*(){n._debug("#_acquireLock","lock acquired for storage key",n.storageKey);try{n.lockAcquired=!0;const s=t();for(n.pendingInLock.push((0,h.Z)(function*(){try{yield s}catch{}})()),yield s;n.pendingInLock.length;){const o=[...n.pendingInLock];yield Promise.all(o),n.pendingInLock.splice(0,o.length)}return yield s}finally{n._debug("#_acquireLock","lock released for storage key",n.storageKey),n.lockAcquired=!1}}))}finally{n._debug("#_acquireLock","end")}})()}_useSession(e){var t=this;return(0,h.Z)(function*(){t._debug("#_useSession","begin");try{const n=yield t.__loadSession();return yield e(n)}finally{t._debug("#_useSession","end")}})()}__loadSession(){var e=this;return(0,h.Z)(function*(){e._debug("#__loadSession()","begin"),e.lockAcquired||e._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const n=yield le(e.storage,e.storageKey);if(e._debug("#getSession()","session from storage",n),null!==n&&(e._isValidSession(n)?t=n:(e._debug("#getSession()","session from storage is not valid"),yield e._removeSession())),!t)return{data:{session:null},error:null};const s=!!t.expires_at&&t.expires_at<=Date.now()/1e3;if(e._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s)return{data:{session:t},error:null};const{session:o,error:a}=yield e._callRefreshToken(t.refresh_token);return a?{data:{session:null},error:a}:{data:{session:o},error:null}}finally{e._debug("#__loadSession()","end")}})()}getUser(e){var t=this;return(0,h.Z)(function*(){return e?yield t._getUser(e):(yield t.initializePromise,t._acquireLock(-1,(0,h.Z)(function*(){return yield t._getUser()})))})()}_getUser(e){var t=this;return(0,h.Z)(function*(){try{return e?yield y(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:e,xform:Z}):yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o,a;const{data:l,error:c}=s;if(c)throw c;return yield y(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:null!==(a=null===(o=l.session)||void 0===o?void 0:o.access_token)&&void 0!==a?a:void 0,xform:Z})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}updateUser(e,t={}){var n=this;return(0,h.Z)(function*(){return yield n.initializePromise,yield n._acquireLock(-1,(0,h.Z)(function*(){return yield n._updateUser(e,t)}))})()}_updateUser(e,t={}){var n=this;return(0,h.Z)(function*(){try{return yield n._useSession(function(){var s=(0,h.Z)(function*(o){const{data:a,error:l}=o;if(l)throw l;if(!a.session)throw new Q;const c=a.session;let u=null,d=null;if("pkce"===n.flowType&&null!=e.email){const f=V();yield q(n.storage,`${n.storageKey}-code-verifier`,f),u=yield W(f),d=f===u?"plain":"s256"}const{data:g,error:p}=yield y(n.fetch,"PUT",`${n.url}/user`,{headers:n.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:u,code_challenge_method:d}),jwt:c.access_token,xform:Z});if(p)throw p;return c.user=g.user,yield n._saveSession(c),yield n._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}});return function(o){return s.apply(this,arguments)}}())}catch(s){if(v(s))return{data:{user:null},error:s};throw s}})()}_decodeJWT(e){return Me(e)}setSession(e){var t=this;return(0,h.Z)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){return yield t._setSession(e)}))})()}_setSession(e){var t=this;return(0,h.Z)(function*(){try{if(!e.access_token||!e.refresh_token)throw new Q;const n=Date.now()/1e3;let s=n,o=!0,a=null;const l=Me(e.access_token);if(l.exp&&(s=l.exp,o=s<=n),o){const{session:c,error:u}=yield t._callRefreshToken(e.refresh_token);if(u)return{data:{user:null,session:null},error:u};if(!c)return{data:{user:null,session:null},error:null};a=c}else{const{data:c,error:u}=yield t._getUser(e.access_token);if(u)throw u;a={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:s-n,expires_at:s},yield t._saveSession(a),yield t._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(n){if(v(n))return{data:{session:null,user:null},error:n};throw n}})()}refreshSession(e){var t=this;return(0,h.Z)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){return yield t._refreshSession(e)}))})()}_refreshSession(e){var t=this;return(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;if(!e){const{data:c,error:u}=s;if(u)throw u;e=null!==(o=c.session)&&void 0!==o?o:void 0}if(null==e||!e.refresh_token)throw new Q;const{session:a,error:l}=yield t._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}_getSessionFromURL(e){var t=this;return(0,h.Z)(function*(){try{if(!L())throw new he("No browser detected.");if("implicit"===t.flowType&&!t._isImplicitGrantFlow())throw new he("Not a valid implicit grant flow url.");if("pkce"==t.flowType&&!e)throw new Be("Not a valid PKCE flow url.");const n=be(window.location.href);if(e){if(!n.code)throw new Be("No code detected.");const{data:T,error:J}=yield t._exchangeCodeForSession(n.code);if(J)throw J;const Qe=new URL(window.location.href);return Qe.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Qe.toString()),{data:{session:T.session,redirectType:null},error:null}}if(n.error||n.error_description||n.error_code)throw new he(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:o,access_token:a,refresh_token:l,expires_in:c,expires_at:u,token_type:d}=n;if(!(a&&c&&l&&d))throw new he("No session defined in URL");const g=Math.round(Date.now()/1e3),p=parseInt(c);let f=g+p;u&&(f=parseInt(u));const _=f-g;1e3*_<=ie&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${_}s, should have been closer to ${p}s`);const m=f-p;g-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,f,g):g-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",m,f,g);const{data:k,error:O}=yield t._getUser(a);if(O)throw O;const j={provider_token:s,provider_refresh_token:o,access_token:a,expires_in:p,expires_at:f,refresh_token:l,token_type:d,user:k.user};return window.location.hash="",t._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:j,redirectType:n.type},error:null}}catch(n){if(v(n))return{data:{session:null,redirectType:null},error:n};throw n}})()}_isImplicitGrantFlow(){const e=be(window.location.href);return!(!L()||!e.access_token&&!e.error_description)}_isPKCEFlow(){var e=this;return(0,h.Z)(function*(){const t=be(window.location.href),n=yield le(e.storage,`${e.storageKey}-code-verifier`);return!(!t.code||!n)})()}signOut(e={scope:"global"}){var t=this;return(0,h.Z)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){return yield t._signOut(e)}))})()}_signOut({scope:e}={scope:"global"}){var t=this;return(0,h.Z)(function*(){return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;const{data:a,error:l}=s;if(l)return{error:l};const c=null===(o=a.session)||void 0===o?void 0:o.access_token;if(c){const{error:u}=yield t.admin.signOut(c,e);if(u&&(!function Vt(i){return v(i)&&"AuthApiError"===i.name}(u)||404!==u.status&&401!==u.status))return{error:u}}return"others"!==e&&(yield t._removeSession(),yield we(t.storage,`${t.storageKey}-code-verifier`),yield t._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}});return function(s){return n.apply(this,arguments)}}())})()}onAuthStateChange(e){var t=this;const n=function Ft(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const r=16*Math.random()|0;return("x"==i?r:3&r|8).toString(16)})}(),s={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,s),(0,h.Z)(function*(){yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){t._emitInitialSession(n)}))})(),{data:{subscription:s}}}_emitInitialSession(e){var t=this;return(0,h.Z)(function*(){return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o,a;try{const{data:{session:l},error:c}=s;if(c)throw c;yield null===(o=t.stateChangeEmitters.get(e))||void 0===o?void 0:o.callback("INITIAL_SESSION",l),t._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){yield null===(a=t.stateChangeEmitters.get(e))||void 0===a?void 0:a.callback("INITIAL_SESSION",null),t._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}});return function(s){return n.apply(this,arguments)}}())})()}resetPasswordForEmail(e,t={}){var n=this;return(0,h.Z)(function*(){let s=null,o=null;if("pkce"===n.flowType){const a=V();yield q(n.storage,`${n.storageKey}-code-verifier`,a),s=yield W(a),o=a===s?"plain":"s256"}try{return yield y(n.fetch,"POST",`${n.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:n.headers,redirectTo:t.redirectTo})}catch(a){if(v(a))return{data:null,error:a};throw a}})()}_refreshAccessToken(e){var t=this;return(0,h.Z)(function*(){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;t._debug(n,"begin");try{const s=Date.now();return yield function zt(i,r){return new Promise((t,n)=>{(0,h.Z)(function*(){for(let s=0;s<1/0;s++)try{const o=yield i(s);if(!r(s,null,o))return void t(o)}catch(o){if(!r(s,o))return void n(o)}})()})}(function(){var o=(0,h.Z)(function*(a){return yield function Mt(i){return ke.apply(this,arguments)}(200*a),t._debug(n,"refreshing attempt",a),yield y(t.fetch,"POST",`${t.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:t.headers,xform:D})});return function(a){return o.apply(this,arguments)}}(),(o,a,l)=>l&&l.error&&Ge(l.error)&&Date.now()+200*(o+1)-s<ie)}catch(s){if(t._debug(n,"error",s),v(s))return{data:{session:null,user:null},error:s};throw s}finally{t._debug(n,"end")}})()}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){var n=this;return(0,h.Z)(function*(){const s=yield n._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return n._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),L()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})()}_recoverAndRefresh(){var e=this;return(0,h.Z)(function*(){var t;const n="#_recoverAndRefresh()";e._debug(n,"begin");try{const s=yield le(e.storage,e.storageKey);if(e._debug(n,"session from storage",s),!e._isValidSession(s))return e._debug(n,"session is not valid"),void(null!==s&&(yield e._removeSession()));const o=Math.round(Date.now()/1e3),a=(null!==(t=s.expires_at)&&void 0!==t?t:1/0)<o+10;if(e._debug(n,`session has${a?"":" not"} expired with margin of 10s`),a){if(e.autoRefreshToken&&s.refresh_token){const{error:l}=yield e._callRefreshToken(s.refresh_token);l&&(console.error(l),Ge(l)||(e._debug(n,"refresh failed with a non-retryable error, removing the session",l),yield e._removeSession()))}}else yield e._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return e._debug(n,"error",s),void console.error(s)}finally{e._debug(n,"end")}})()}_callRefreshToken(e){var t=this;return(0,h.Z)(function*(){var n,s;if(!e)throw new Q;if(t.refreshingDeferred)return t.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;t._debug(o,"begin");try{t.refreshingDeferred=new ce;const{data:a,error:l}=yield t._refreshAccessToken(e);if(l)throw l;if(!a.session)throw new Q;yield t._saveSession(a.session),yield t._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const c={session:a.session,error:null};return t.refreshingDeferred.resolve(c),c}catch(a){if(t._debug(o,"error",a),v(a)){const l={session:null,error:a};return null===(n=t.refreshingDeferred)||void 0===n||n.resolve(l),l}throw null===(s=t.refreshingDeferred)||void 0===s||s.reject(a),a}finally{t.refreshingDeferred=null,t._debug(o,"end")}})()}_notifyAllSubscribers(e,t,n=!0){var s=this;return(0,h.Z)(function*(){const o=`#_notifyAllSubscribers(${e})`;s._debug(o,"begin",t,`broadcast = ${n}`);try{s.broadcastChannel&&n&&s.broadcastChannel.postMessage({event:e,session:t});const a=[],l=Array.from(s.stateChangeEmitters.values()).map(function(){var c=(0,h.Z)(function*(u){try{yield u.callback(e,t)}catch(d){a.push(d)}});return function(u){return c.apply(this,arguments)}}());if(yield Promise.all(l),a.length>0){for(let c=0;c<a.length;c+=1)console.error(a[c]);throw a[0]}}finally{s._debug(o,"end")}})()}_saveSession(e){var t=this;return(0,h.Z)(function*(){t._debug("#_saveSession()",e),yield t._persistSession(e)})()}_persistSession(e){return this._debug("#_persistSession()",e),q(this.storage,this.storageKey,e)}_removeSession(){var e=this;return(0,h.Z)(function*(){e._debug("#_removeSession()"),yield we(e.storage,e.storageKey)})()}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&L()&&null!=window&&window.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){var e=this;return(0,h.Z)(function*(){yield e._stopAutoRefresh(),e._debug("#_startAutoRefresh()");const t=setInterval(()=>e._autoRefreshTokenTick(),ie);e.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():typeof Deno<"u"&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout((0,h.Z)(function*(){yield e.initializePromise,yield e._autoRefreshTokenTick()}),0)})()}_stopAutoRefresh(){var e=this;return(0,h.Z)(function*(){e._debug("#_stopAutoRefresh()");const t=e.autoRefreshTicker;e.autoRefreshTicker=null,t&&clearInterval(t)})()}startAutoRefresh(){var e=this;return(0,h.Z)(function*(){e._removeVisibilityChangedCallback(),yield e._startAutoRefresh()})()}stopAutoRefresh(){var e=this;return(0,h.Z)(function*(){e._removeVisibilityChangedCallback(),yield e._stopAutoRefresh()})()}_autoRefreshTokenTick(){var e=this;return(0,h.Z)(function*(){e._debug("#_autoRefreshTokenTick()","begin");try{yield e._acquireLock(0,(0,h.Z)(function*(){try{const t=Date.now();try{return yield e._useSession(function(){var n=(0,h.Z)(function*(s){const{data:{session:o}}=s;if(!o||!o.refresh_token||!o.expires_at)return void e._debug("#_autoRefreshTokenTick()","no session");const a=Math.floor((1e3*o.expires_at-t)/ie);e._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),a<=3&&(yield e._callRefreshToken(o.refresh_token))});return function(s){return n.apply(this,arguments)}}())}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{e._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(!(t.isAcquireTimeout||t instanceof hr))throw t;e._debug("auto refresh token tick lock not available")}})()}_handleVisibilityChange(){var e=this;return(0,h.Z)(function*(){if(e._debug("#_handleVisibilityChange()"),!L()||null==window||!window.addEventListener)return e.autoRefreshToken&&e.startAutoRefresh(),!1;try{e.visibilityChangedCallback=(0,h.Z)(function*(){return yield e._onVisibilityChanged(!1)}),null==window||window.addEventListener("visibilitychange",e.visibilityChangedCallback),yield e._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})()}_onVisibilityChanged(e){var t=this;return(0,h.Z)(function*(){const n=`#_onVisibilityChanged(${e})`;t._debug(n,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(t.autoRefreshToken&&t._startAutoRefresh(),e||(yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){"visible"===document.visibilityState?yield t._recoverAndRefresh():t._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&t.autoRefreshToken&&t._stopAutoRefresh()})()}_getUrlForProvider(e,t){var n=this;return(0,h.Z)(function*(){const s=[`provider=${encodeURIComponent(e)}`];if(null!=t&&t.redirectTo&&s.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),null!=t&&t.scopes&&s.push(`scopes=${encodeURIComponent(t.scopes)}`),"pkce"===n.flowType){const o=V();yield q(n.storage,`${n.storageKey}-code-verifier`,o);const a=yield W(o),l=o===a?"plain":"s256";n._debug("PKCE","code verifier",`${o.substring(0,5)}...`,"code challenge",a,"method",l);const c=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(l)}`});s.push(c.toString())}if(null!=t&&t.queryParams){const o=new URLSearchParams(t.queryParams);s.push(o.toString())}return`${n.url}/authorize?${s.join("&")}`})()}_unenroll(e){var t=this;return(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;const{data:a,error:l}=s;return l?{data:null,error:l}:yield y(t.fetch,"DELETE",`${t.url}/factors/${e.factorId}`,{headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}})()}_enroll(e){var t=this;return(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o,a;const{data:l,error:c}=s;if(c)return{data:null,error:c};const{data:u,error:d}=yield y(t.fetch,"POST",`${t.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:t.headers,jwt:null===(o=null==l?void 0:l.session)||void 0===o?void 0:o.access_token});return d?{data:null,error:d}:(!(null===(a=null==u?void 0:u.totp)||void 0===a)&&a.qr_code&&(u.totp.qr_code=`data:image/svg+xml;utf-8,${u.totp.qr_code}`),{data:u,error:null})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}})()}_verify(e){var t=this;return(0,h.Z)(function*(){return t._acquireLock(-1,(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;const{data:a,error:l}=s;if(l)return{data:null,error:l};const{data:c,error:u}=yield y(t.fetch,"POST",`${t.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token});return u?{data:null,error:u}:(yield t._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),yield t._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),{data:c,error:u})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}}))})()}_challenge(e){var t=this;return(0,h.Z)(function*(){return t._acquireLock(-1,(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;const{data:a,error:l}=s;return l?{data:null,error:l}:yield y(t.fetch,"POST",`${t.url}/factors/${e.factorId}/challenge`,{headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}}))})()}_challengeAndVerify(e){var t=this;return(0,h.Z)(function*(){const{data:n,error:s}=yield t._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield t._verify({factorId:e.factorId,challengeId:n.id,code:e.code})})()}_listFactors(){var e=this;return(0,h.Z)(function*(){const{data:{user:t},error:n}=yield e.getUser();if(n)return{data:null,error:n};const s=(null==t?void 0:t.factors)||[],o=s.filter(a=>"totp"===a.factor_type&&"verified"===a.status);return{data:{all:s,totp:o},error:null}})()}_getAuthenticatorAssuranceLevel(){var e=this;return(0,h.Z)(function*(){return e._acquireLock(-1,(0,h.Z)(function*(){return yield e._useSession(function(){var t=(0,h.Z)(function*(n){var s,o;const{data:{session:a},error:l}=n;if(l)return{data:null,error:l};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const c=e._decodeJWT(a.access_token);let u=null;c.aal&&(u=c.aal);let d=u;return(null!==(o=null===(s=a.user.factors)||void 0===s?void 0:s.filter(f=>"verified"===f.status))&&void 0!==o?o:[]).length>0&&(d="aal2"),{data:{currentLevel:u,nextLevel:d,currentAuthenticationMethods:c.amr||[]},error:null}});return function(n){return t.apply(this,arguments)}}())}))})()}}return i.nextInstanceID=0,i})();class _r extends pr{constructor(r){super(r)}}const yr={headers:Pt},mr={schema:"public"},br={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wr={};class kr{constructor(r,e,t){var n,s,o,a,l,c,u,d;if(this.supabaseUrl=r,this.supabaseKey=e,!r)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const g=function Dt(i){return i.replace(/\/$/,"")}(r);this.realtimeUrl=`${g}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${g}/auth/v1`,this.storageUrl=`${g}/storage/v1`,this.functionsUrl=`${g}/functions/v1`;const p=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,_=function Zt(i,r){const{db:e,auth:t,realtime:n,global:s}=i,{db:o,auth:a,realtime:l,global:c}=r;return{db:Object.assign(Object.assign({},o),e),auth:Object.assign(Object.assign({},a),t),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},c),s)}}(null!=t?t:{},{db:mr,realtime:wr,auth:Object.assign(Object.assign({},br),{storageKey:p}),global:yr});this.storageKey=null!==(s=null===(n=_.auth)||void 0===n?void 0:n.storageKey)&&void 0!==s?s:"",this.headers=null!==(a=null===(o=_.global)||void 0===o?void 0:o.headers)&&void 0!==a?a:{},this.auth=this._initSupabaseAuthClient(null!==(l=_.auth)&&void 0!==l?l:{},this.headers,null===(c=_.global)||void 0===c?void 0:c.fetch),this.fetch=Ut(e,this._getAccessToken.bind(this),null===(u=_.global)||void 0===u?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},_.realtime)),this.rest=new fe(`${g}/rest/v1`,{headers:this.headers,schema:null===(d=_.db)||void 0===d?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new N(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new At(this.storageUrl,this.headers,this.fetch)}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var r,e;return function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(u){try{c(t.next(u))}catch(d){o(d)}}function l(u){try{c(t.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(u.value).then(a,l)}c((t=t.apply(i,r||[])).next())})}(this,void 0,void 0,function*(){const{data:t}=yield this.auth.getSession();return null!==(e=null===(r=t.session)||void 0===r?void 0:r.access_token)&&void 0!==e?e:null})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,storageKey:s,flowType:o,debug:a},l,c){return new _r({url:this.authUrl,headers:Object.assign(Object.assign({},{Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`}),l),storageKey:s,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,flowType:o,debug:a,fetch:c})}_initRealtimeClient(r){return new mt(this.realtimeUrl,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},null==r?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(r,e,t){"TOKEN_REFRESHED"!==r&&"SIGNED_IN"!==r||this.changedAccessToken===t?"SIGNED_OUT"===r&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=t?t:null),this.changedAccessToken=t)}}var xr=w(6689);let Or=(()=>{var i;class r{constructor(){this.supabase=new kr("https://hnkltjvfhndkihhzifea.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhua2x0anZmaG5ka2loaHppZmVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDA3NTYzNzQsImV4cCI6MjAxNjMzMjM3NH0.IpzLTAXA4f9q3nWvMJOJwP_t6-1w54fqjG3UsIUx3kw",void 0)}getSupabase(){return this.supabase}}return(i=r).\u0275fac=function(t){return new(t||i)},i.\u0275prov=xr.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),r})()},9470:(C,I,w)=>{"use strict";w.r(I),w.d(I,{Headers:()=>R,Request:()=>z,Response:()=>N,default:()=>M,fetch:()=>ee});var S=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}();const ee=S.fetch,M=S.fetch.bind(S),R=S.Headers,z=S.Request,N=S.Response},2150:C=>{var I=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};C.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return I()}try{return __global__||I()}finally{delete Object.prototype.__global__}}()},6624:(C,I,w)=>{var A;if("object"==typeof globalThis)A=globalThis;else try{A=w(2150)}catch{}finally{if(!A&&typeof window<"u"&&(A=window),!A)throw new Error("Could not determine global this")}var S=A.WebSocket||A.MozWebSocket,ee=w(7490);function M(R,z){return z?new S(R,z):new S(R)}S&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(R){Object.defineProperty(M,R,{get:function(){return S[R]}})}),C.exports={w3cwebsocket:S?M:null,version:ee}},7490:(C,I,w)=>{C.exports=w(9794).version},9794:C=>{"use strict";C.exports={version:"1.0.34"}}}]);